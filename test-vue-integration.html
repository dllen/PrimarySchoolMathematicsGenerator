<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>策略模式集成测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .problem { margin: 5px 0; padding: 5px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>策略模式重构 - Vue组件集成测试</h1>
    
    <div class="test-section">
        <h2>测试结果</h2>
        <div id="test-results"></div>
    </div>

    <script type="module">
        import { ProblemGeneratorContext } from './src/strategies/ProblemGeneratorFactory.js';

        // 模拟Vue组件的配置
        const config = {
            digits: { add: 2, subtract: 2, multiply: 1, divide: 1 },
            problemCount: 5,
            termCount: 3,
            operations: { add: true, subtract: true, multiply: true, divide: false },
            useBrackets: false,
            allowRepeatOperators: true,
            problemType: 'result',
        };

        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            let testResults = [];

            try {
                // 测试1: 初始化题目生成器
                testResults.push('✅ 测试1: 题目生成器初始化成功');
                const problemGenerator = new ProblemGeneratorContext(config);
                problemGenerator.setStrategy(config.problemType);

                // 测试2: 生成求结果题目
                testResults.push('✅ 测试2: 求结果题目生成');
                const resultProblems = problemGenerator.generateProblems(3);
                resultProblems.forEach((problem, index) => {
                    testResults.push(`  题目${index + 1}: ${problem.expression} (答案: ${problem.answer})`);
                });

                // 测试3: 切换到求运算项策略
                testResults.push('✅ 测试3: 切换到求运算项策略');
                problemGenerator.setStrategy('operand');
                const operandProblems = problemGenerator.generateProblems(3);
                operandProblems.forEach((problem, index) => {
                    testResults.push(`  题目${index + 1}: ${problem.expression} (答案: ${problem.answer})`);
                });

                // 测试4: 配置更新
                testResults.push('✅ 测试4: 配置更新测试');
                problemGenerator.updateConfig({ 
                    allowRepeatOperators: false,
                    termCount: 2 
                });
                problemGenerator.setStrategy('result');
                const updatedProblems = problemGenerator.generateProblems(2);
                updatedProblems.forEach((problem, index) => {
                    testResults.push(`  更新后题目${index + 1}: ${problem.expression} (答案: ${problem.answer})`);
                });

                testResults.push('🎉 所有测试通过！策略模式重构成功！');

            } catch (error) {
                testResults.push(`❌ 测试失败: ${error.message}`);
                console.error('详细错误:', error);
            }

            // 显示结果
            resultsDiv.innerHTML = testResults.map(result => 
                `<div class="problem ${result.includes('❌') ? 'error' : 'success'}">${result}</div>`
            ).join('');
        }

        // 运行测试
        runTests();
    </script>
</body>
</html>